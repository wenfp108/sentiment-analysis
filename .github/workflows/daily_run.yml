name: Woonbot Sentinel (Backup Mode)

on:
  workflow_dispatch:        # å»ºè®®åªå¼€æ‰‹åŠ¨ï¼Œé˜²æ­¢å’Œ Serv00 å†²çª
  # schedule:
  #   - cron: '43 */4 * * *'  # å¦‚æœ Serv00 æŒ‚äº†ï¼Œå†æŠŠè¿™ä¸ªè§£å¼€

permissions:
  contents: read

jobs:
  analyze-and-sync:
    runs-on: ubuntu-latest
    timeout-minutes: 10  # ç›´è¿å¾ˆå¿«ï¼Œä¸éœ€è¦ 40 åˆ†é’Ÿ

    steps:
    - name: ğŸ“¥ æ‹‰å–ä»£ç 
      uses: actions/checkout@v3

    - name: ğŸ è®¾ç½® Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        cache: 'pip'

    # âŒ åˆ é™¤äº† "å®‰è£… Tor" æ­¥éª¤

    - name: ğŸ§  ç¼“å­˜ HuggingFace æ¨¡å‹
      uses: actions/cache@v3
      with:
        path: ~/.cache/huggingface
        key: ${{ runner.os }}-hf-v1

    - name: âš¡ å®‰è£…ä¾èµ–
      run: |
        pip install --upgrade pip
        # åªè£… CPU ç‰ˆ PyTorch
        pip install torch --index-url https://download.pytorch.org/whl/cpu
        
        # âŒ åˆ é™¤äº† requests[socks] å’Œ stem (ä¸éœ€è¦ Tor æ”¯æŒ)
        # âŒ åˆ é™¤äº† transformers (å¦‚æœä¸ºäº†è½»é‡åŒ–ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥ä¸è£…ï¼Œä½†ä¸ºäº†å…¼å®¹æ€§å¯ä»¥ç•™ç€)
        pip install requests pandas numpy transformers
        
        # å®‰è£… NLP åº“
        pip install https://github.com/explosion/spacy-models/releases/download/en_core_web_sm-3.7.1/en_core_web_sm-3.7.1-py3-none-any.whl
        pip install textblob nltk contractions emoji spacy

    - name: ğŸ“¥ è¡¥å…… NLTK æ•°æ®
      run: |
        python -m nltk.downloader stopwords punkt wordnet averaged_perceptron_tagger

    - name: ğŸ¤– è¿è¡Œè„šæœ¬
      env:
        GITHUB_TOKEN: ${{ secrets.GH_PAT }}
      run: python headless_main.py
