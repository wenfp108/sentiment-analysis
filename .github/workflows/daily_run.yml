name: Woonbot Sentinel (Direct-Sync)

on:
  schedule:
    - cron: '43 */4 * * *'  # æ¯ 4 å°æ—¶ (UTCæ—¶é—´)
  workflow_dispatch:        # å…è®¸æ‰‹åŠ¨è§¦å‘

permissions:
  contents: read  # åªéœ€è¦è¯»å–å½“å‰ä»“åº“çš„ä»£ç 

jobs:
  analyze-and-sync:
    runs-on: ubuntu-latest

    steps:
    - name: ğŸ“¥ æ‹‰å–ä»£ç 
      uses: actions/checkout@v3

    - name: ğŸ è®¾ç½® Python (é«˜é€Ÿç¼“å­˜)
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        cache: 'pip'
        cache-dependency-path: '**/requirements.txt'

    # ç¼“å­˜ NLTK æ•°æ®ï¼Œé˜²æ­¢æ¯æ¬¡éƒ½ä¸‹è½½ï¼ŒåŠ å¿«è¿è¡Œé€Ÿåº¦
    - name: ğŸ§  ç¼“å­˜ NLTK æ•°æ®
      uses: actions/cache@v3
      with:
        path: ~/nltk_data
        key: ${{ runner.os }}-nltk-v2

    # ç¼“å­˜ HuggingFace æ¨¡å‹ (DistilBERT)ï¼Œè¿™ä¸ªå¾ˆå¤§ï¼Œå¿…é¡»ç¼“å­˜
    - name: ğŸ§  ç¼“å­˜ HuggingFace æ¨¡å‹
      uses: actions/cache@v3
      with:
        path: ~/.cache/huggingface
        key: ${{ runner.os }}-huggingface-v1

    - name: ğŸ“¦ å®‰è£…ä¾èµ–
      run: |
        # 1. å‡çº§ pip
        python -m pip install --upgrade pip
        
        # 2. å®‰è£…æ ¸å¿ƒä¾èµ– (å»æ‰äº† prawï¼Œä¿ç•™äº†è®¡ç®—å’ŒAIåº“)
        # requests: æŠ“å–é•œåƒç«™ + ä¸Šä¼  Github
        # transformers/torch: è¿è¡Œ BERT æƒ…ç»ªæ¨¡å‹
        # textblob/nltk: æ–‡æœ¬æ¸…æ´—å’ŒåŸºç¡€æƒ…ç»ª
        pip install requests pandas numpy textblob transformers torch
        
        # 3. è¡¥å……ä¸‹è½½ NLTK è¯­æ–™åº“ (ç”¨äº text_processor æ¸…æ´—)
        python -m textblob.download_corpora
        python -m nltk.downloader stopwords wordnet punkt

    - name: ğŸ¤– è¿è¡Œå¹¶åŒæ­¥è‡³é“¶è¡Œ
      env:
        # âœ… å”¯ä¸€éœ€è¦çš„å¯†é’¥ï¼šç”¨äºä¸Šä¼  JSON åˆ° Central-Bank
        GITHUB_TOKEN: ${{ secrets.GH_PAT }}
        
        # âŒ å·²åˆ é™¤ REDDIT_CLIENT_ID ç­‰å¯†é’¥ï¼Œä¸å†éœ€è¦
      run: python headless_main.py
