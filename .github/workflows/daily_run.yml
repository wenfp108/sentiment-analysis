name: sentiment-analysis

on:
  schedule:
    - cron: '43 */4 * * *'  # æ¯ 4 å°æ—¶ (UTCæ—¶é—´)
  workflow_dispatch:        # å…è®¸æ‰‹åŠ¨è§¦å‘

permissions:
  contents: read

jobs:
  analyze-and-sync:
    runs-on: ubuntu-latest

    steps:
    - name: ğŸ“¥ æ‹‰å–ä»£ç 
      uses: actions/checkout@v3

    - name: ğŸ è®¾ç½® Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        cache: 'pip'

    - name: ğŸ§  ç¼“å­˜ HuggingFace æ¨¡å‹
      uses: actions/cache@v3
      with:
        path: ~/.cache/huggingface
        key: ${{ runner.os }}-huggingface-v1

    - name: ğŸ“¦ å®‰è£…ä¾èµ–
      run: |
        python -m pip install --upgrade pip
        
        # 1. å®‰è£…æ ¸å¿ƒè®¡ç®—åº“
        pip install requests pandas numpy transformers torch
        
        # 2. å®‰è£…æ–‡æœ¬å¤„ç†åº“ (ä¿®å¤æŠ¥é”™çš„å…³é”®)
        # contractions: ä¿®å¤ "No module named contractions"
        # emoji: ä¿®å¤æ½œåœ¨çš„ "No module named emoji"
        # spacy: ä¿®å¤ "No module named spacy"
        pip install textblob nltk contractions emoji spacy
        
        # 3. ä¸‹è½½ Spacy è¯­è¨€æ¨¡å‹ (éå¸¸é‡è¦ï¼Œå¦åˆ™ä¼šæŠ¥æ‰¾ä¸åˆ° en_core_web_sm)
        python -m spacy download en_core_web_sm

    - name: ğŸ“¥ ä¸‹è½½ NLTK è¯­æ–™åº“
      run: |
        # ä¸‹è½½ä»£ç ä¸­éœ€è¦çš„ NLTK æ•°æ®åŒ…
        python -m nltk.downloader stopwords punkt wordnet averaged_perceptron_tagger

    - name: ğŸ¤– è¿è¡Œå¹¶åŒæ­¥è‡³é“¶è¡Œ
      env:
        GITHUB_TOKEN: ${{ secrets.GH_PAT }}
      run: python headless_main.py
