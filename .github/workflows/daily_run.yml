name: sentiment-analysis (Fast & Fix)

on:
  schedule:
    - cron: '43 */4 * * *'  # æ¯ 4 å°æ—¶
  workflow_dispatch:        # å…è®¸æ‰‹åŠ¨è§¦å‘

permissions:
  contents: read

jobs:
  analyze-and-sync:
    runs-on: ubuntu-latest

    steps:
    - name: ğŸ“¥ æ‹‰å–ä»£ç 
      uses: actions/checkout@v3

    - name: ğŸ è®¾ç½® Python (å¼€å¯ pip ç¼“å­˜)
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        cache: 'pip' # ğŸ‘ˆ å…³é”®ï¼šè‡ªåŠ¨ç¼“å­˜ä¸‹æ¬¡è¿è¡Œçš„ä¾èµ–

    - name: ğŸ§  ç¼“å­˜ HuggingFace æ¨¡å‹
      uses: actions/cache@v3
      with:
        path: ~/.cache/huggingface
        key: ${{ runner.os }}-hf-v1

    - name: âš¡ æé€Ÿå®‰è£…ä¾èµ–
      run: |
        pip install --upgrade pip
        
        # 1. ğŸš€ æ ¸å¿ƒåŠ é€Ÿï¼šå¼ºåˆ¶åªå®‰è£… CPU ç‰ˆ PyTorch (å‡ åMB vs å‡ ç™¾MB)
        # è¿™å°±æ˜¯ä¹‹å‰å¡ä½  8 åˆ†é’Ÿçš„ç½ªé­ç¥¸é¦–
        pip install torch --index-url https://download.pytorch.org/whl/cpu
        
        # 2. å®‰è£…è®¡ç®—åº“
        pip install requests pandas numpy transformers
        
        # 3. å®‰è£…æ–‡æœ¬åº“ (åŒ…å«ä¿®å¤ contractions ç¼ºå¤±)
        # æŠ€å·§ï¼šç›´æ¥é€šè¿‡ URL å®‰è£… spacy æ¨¡å‹ï¼Œåˆ©ç”¨ pip ç¼“å­˜ï¼Œæ— éœ€ç°åœºä¸‹è½½
        pip install https://github.com/explosion/spacy-models/releases/download/en_core_web_sm-3.7.1/en_core_web_sm-3.7.1-py3-none-any.whl
        pip install textblob nltk contractions emoji spacy

    - name: ğŸ“¥ è¡¥å…… NLTK æ•°æ®
      run: |
        # ä¸‹è½½æ¸…æ´—æ–‡æœ¬æ‰€éœ€çš„å°å‹è¯­æ–™åº“
        python -m nltk.downloader stopwords punkt wordnet averaged_perceptron_tagger

    - name: ğŸ¤– è¿è¡Œè„šæœ¬
      env:
        GITHUB_TOKEN: ${{ secrets.GH_PAT }}
      run: python headless_main.py
